<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Purchase Order</title>

    <link rel="stylesheet" href="../../../css/styles.css">

    <!-- bootstrap -->
    <link rel="stylesheet" href="../../../css/bootstrap-yeti.min.css">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"> -->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
        integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <style>
        /* .pm-0 {
                    padding: 0px !important;
        
                    margin: 0px !important;
                } */
        .cont {
            overflow: scroll;

        }

        .list_cont {
            list-style: none;
            margin: 0;
            padding: 0
        }

        .pointer {
            cursor: pointer;
        }

        .pointer:hover {
            background: rgb(255, 241, 223)
        }

        .pm-0 {
            padding: 0px !important;

            margin: 0px !important;
        }

        tr td {
            padding: 2px !important;
            margin: 0 !important;
        }

        tr th {
            padding: 2px !important;
            margin: 0 !important;
        }

        body {
            /* overflow: hidden;
                    sc */
            margin: 0;
            padding: 0;
            font-family: 'Gill Sans', 'Gill Sans MT', 'Calibri', 'Trebuchet MS', sans-serif
        }

        input {
            font-size: 12px !important;
            padding: 5px !important;
            max-height: 30px !important;
        }

        .col-4 p {
            font-size: 12px !important
        }

        select {
            font-size: 12px !important;
            padding: 5px !important;
            max-height: 30px !important;
        }
    </style>

</head>

<body onload="fill()">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <img src="../../../assets/img/aa-logo.jpg" class=" float-right md-logo" alt="logo" width="70px">
        <a class="navbar-brand text-light navbar-left ml-3" href="/">

            ABBAS ALI & SONS UNIFORMS AND TEXTILES
        </a>
        <button class="navbar-toggler bg-dark" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div>
            &nbsp;
        </div>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto text-light f-17">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Sales
                    </a>
                    <div class="dropdown-menu text-light bg-dark" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item text-info" href="/sale/sales_order">Sales Order</a>
                        <a class="dropdown-item text-info" href="/sale/packing_list">Packing List</a>
                        <a class="dropdown-item text-info" href="/sale/commercial_invoice">Commercial Invoice</a>
                        <a class="dropdown-item text-info" href="/sale/reciept_voucher">Reciept Voucher</a>

                    </div>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Purchase
                    </a>
                    <div class="dropdown-menu text-light bg-dark" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item text-info" href="/purchase/purchase_order">Purchase Order</a>
                        <a class="dropdown-item text-info" href="/purchase/gr_note">Good Recieving Note / Invoice</a>
                        <a class="dropdown-item text-info" href="/purchase/payment_voucher">Vendor Payment</a>
                    </div>
                </li>



                <li class="nav-item">
                    <a class="nav-link text-light" href="/production">Production</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Reports
                    </a>
                    <div class="dropdown-menu text-light bg-dark" aria-labelledby="navbarDropdown">
                        <a class="dropdown-item text-info" href="/reports/sales_report">Sales Report</a>
                        <a class="dropdown-item text-info" href="/reports/purchase_report">Purchase Report</a>
                        <a class="dropdown-item text-info" href="/reports/production_report">Production Report</a>
                        <a class="dropdown-item text-info" href="/reports/accounts_report">Accounts Report</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/master" tabindex="-1" aria-disabled="true">Master Data</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/master_view" tabindex="-1" aria-disabled="true">Master
                        View</a>
                </li>
            </ul>

        </div>
    </nav>
    <hr class="pm-0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-2 col-md-3 col-lg-3 bg-s-green">

                <div class="row">
                    <div class="col-md-12 mt-4">
                        <h5>Search Order</h5>
                        <div class="form-group row m-1">
                            <div class="col-md-12">
                                <input type="text" placeholder="Search by VPO#" id='input_search_po'
                                    class="form-control" list='po_data_list'>
                                <datalist id='po_data_list'>

                                </datalist>
                            </div>
                        </div>
                        <div class="row pr-1">
                            <div class="col-md-12">
                                <button class='btn btn-primary float-right mr-3' onClick='po_search()'>Search</button>
                            </div>
                        </div>
                    </div>
                    <hr class="m-1">
                    <div class="list_cont" id='cpo_list'>

                    </div>

                </div>

            </div>
            <div class="col-sm-10 col-md-9 col-lg-9">

                <div class="container sales-container" id="main_place">
                    <div class="packing-slip-header">
                        <div class="row">
                            <div class="col-sm-12 col-md-12 col-lg-12">
                                <h3 class="text-center mb-2 mt-4">PURCHASE ORDER</h3>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="row">
                                    <div class="col-4">
                                        <p>Date:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="date" class="form-control" id="pur-date">
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="row">
                                    <div class="col-4">
                                        <p>Payment Due Date:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="date" class="form-control" id="payment_date">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="row">
                                    <div class="col-4">
                                        <p> V.P.O # </p>
                                    </div>
                                    <div class="col-8">
                                        <input class="form-control" id="pur-po" readonly />

                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="row">
                                    <div class="col-4">
                                        <p> C.P.O Ref </p>
                                    </div>
                                    <div class="col-8">
                                        <select class="form-control" id="lpo_ref">
                                            <option>Select C.P.O</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">

                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <h3 class="main-subject">VENDOR:</h3>

                                <div class="row">
                                    <div class="col-4">
                                        <p>Company Name:</p>
                                    </div>
                                    <div class="col-8">
                                        <select name="vender-info" id="pur-company-name" class="form-control"
                                            onchange="fill_vendor()">
                                        </select>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        <p>Name:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" name="vender-info" id="pur-name" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        <p>Street Address</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" name="vender-info" id="pur-vender-address"
                                            class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        <p>City or ZIP:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" name="vender-info" id="pur-vender-city" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        <p>Phone:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" name="vender-info" id="pur-vender-phone"
                                            class="form-control">
                                    </div>
                                </div>

                            </div>


                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <h3 class="main-subject">Ship To:</h3>
                                <div class="row">
                                    <div class="col-4">
                                        <p>Name:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" id="pur-ship-name" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        <p>Street Address</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" id="pur-ship-address" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        <p>City or ZIP:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" name="ship-info" id="pur-ship-city" class="form-control">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-4">
                                        <p>Phone:</p>
                                    </div>
                                    <div class="col-8">
                                        <input type="text" name="ship-info" id="pur-ship-phone" class="form-control">
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- packing address section -->



                    <table class="table table-bordered mt-4">
                        <thead>
                            <tr class="d-flex">
                                <td class="col-2">Item #</td>
                                <td class="col-6">Description</td>
                                <td class="col-2">Quantity</td>
                                <td class="col-2">
                                    <div class="row">
                                        <span class="col-md-6" style="font-size: 16px">Unit Price</span>
                                        <span class="col-md-6">
                                            <select class='form-control' id='currency' style="font-size: 12px"
                                                onchange="currency_effect(this)" onClick='apply_currency(this)'>
                                                <option value='PKR'>PKR</option>
                                                <option value='USD'>USD</option>
                                                <option value='EURO'>EURO</option>
                                                <option value='GBP'>GBP</option>
                                                <option value='AED'>AED</option>
                                            </select>
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        </thead>
                        <tbody id='items_table'>
                            <tr class="d-flex">
                                <td class="col-2 td-cells">
                                    <select class="form-control" id="pro1category" onclick="load_items(this)"
                                        onchange="set_item(this)">
                                    </select>
                                </td>
                                <td class="col-6 td-cells">
                                    <input type="text" class="form-control" id="pro1description">
                                </td>
                                <td class="col-2 td-cells">
                                    <input type="text" class="form-control" id="pro1quantityavailable"
                                        style="width: 75%;float: left;">
                                    <span></span>
                                </td>
                                <td class="col-2 td-cells">
                                    <input type="text" class="form-control" id="pro1unitprice"
                                        onkeypress="add_new(event)">
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <section class="color-1 text-center">
                        <p> <a class='btn btn-primary' data-toggle="modal" data-target="#myModal">Terms and
                                Condition</a>
                            <button onclick="generate_purchase_order(this)" class="btn btn-primary" id='proceed_btn'
                                disabled>Generate</button>
                        </p>
                    </section>

                </div>

            </div>
        </div>
    </div>


    <!-- The Modal -->
    <div class="modal" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Terms and Conditions</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <p id="purchase_terms">Loading...</p>

                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="activate_btn()" data-dismiss="modal">Accept
                        Terms & Conditions</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>

            </div>
        </div>
    </div>

    <!---  modal-->

</body>
<script>
    function activate_btn() {
        document.getElementById('proceed_btn').disabled = false;
    }
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous">
    </script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous">
    </script>

<script src="../../../js/app.js"></script>

<script>
    let vendors, lpos, raw_items, pos, USD, GBP, EURO, AED;

    function fill() {
        let select = document.getElementById('pur-company-name');
        let select_item = document.getElementById('pro1category');
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                let str = '<option value="null">Select Company</option>';
                vendors = JSON.parse(this.responseText).vendors;
                vendors.forEach(vendor => {
                    str += `<option value='` + vendor.company_name + `'>` + vendor.company_name +
                        `</option>`
                });
                select.innerHTML = str;
                console.log(vendors);
            }
        };
        xhttp.open("GET", "/get_vendors", true);
        xhttp.send();
        // get raw_items
        var xhttp2 = new XMLHttpRequest();
        xhttp2.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                str = '<option value="null">Select Raw Item</option>';
                raw_items = JSON.parse(this.responseText).raw_items;
                raw_items.forEach(raw_item => {
                    str += `<option value='` + raw_item.name + `'>` + raw_item.name + `</option>`
                });
                select_item.innerHTML = str;
                console.log(raw_items);
            }
        };
        xhttp2.open("GET", "/get_raw_items", true);
        xhttp2.send();
        /// get raw_items
        //// lpos get 
        var xhttp3 = new XMLHttpRequest();
        xhttp3.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                lpos = JSON.parse(this.responseText).lpos;
                str = '<option>Select C.P.O</option>';
                // alert(e.innerHTML.length)
                lpos.forEach((lpo) => {
                    str += `<option>` + lpo.ref + `</option>`;
                });
                document.getElementById('lpo_ref').innerHTML = str;

                console.log(lpos)
            }
        };
        xhttp3.open("GET", "/get_lpos?flag=order_phase", true);
        xhttp3.send();

        //// lpos get
        var xhttp4 = new XMLHttpRequest();
        xhttp4.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById('pur-po').value = new Date().getFullYear() + "/" + JSON.parse(this
                    .responseText).info[0].po_num;
                document.getElementById("purchase_terms").innerHTML = JSON.parse(this.responseText).info[0]
                    .purchase_terms;
                USD = JSON.parse(this.responseText).info[0].USD;
                GBP = JSON.parse(this.responseText).info[0].GBP;
                EURO = JSON.parse(this.responseText).info[0].EURO;
                AED = JSON.parse(this.responseText).info[0].AED;

            }
        };
        xhttp4.open("GET", "/get_info", true);
        xhttp4.send();
        // POS
        var xhttp5 = new XMLHttpRequest();
        xhttp5.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                pos = JSON.parse(this.responseText).pos;
                populate_cpos();
                console.log("pos", pos);
            }
        };
        xhttp5.open("GET", "/get_pos", true);
        xhttp5.send();


    }

    function fill_vendor() {
        let name = document.getElementById('pur-company-name').value;
        if (name === "null") {
            document.getElementById('pur-name').value = '';
            document.getElementById('pur-vender-address').value = '';
            document.getElementById('pur-vender-city').value = '';
            document.getElementById('pur-vender-phone').value = '';
            document.getElementById('pur-ship-name').value = '';
            document.getElementById('pur-ship-address').value = '';
            document.getElementById('pur-ship-city').value = '';
            document.getElementById('pur-ship-phone').value = '';
        } else {
            vendors.forEach((vendor) => {
                if (name === vendor.company_name) {
                    document.getElementById('pur-name').value = vendor.name;
                    document.getElementById('pur-vender-address').value = vendor.street;
                    document.getElementById('pur-vender-city').value = vendor.city;
                    document.getElementById('pur-vender-phone').value = vendor.phone;
                    document.getElementById('pur-ship-name').value = vendor.name;
                    document.getElementById('pur-ship-address').value = vendor.street;
                    document.getElementById('pur-ship-city').value = vendor.city;
                    document.getElementById('pur-ship-phone').value = vendor.phone;

                }

            })
        }

    }

    function load_lpos(e) {
        let str = '';
        // alert(e.innerHTML.length)
        if (e.innerHTML.length < 10) {
            lpos.forEach((lpo) => {
                str += `<option>` + lpo.ref + `</option>`;
            });
            e.innerHTML = str;
        }
        console.log("str:" + str);




    }

    function set_item(e) {
        // alert(e.value);
        let value = e.value;
        let detail = e.parentNode.parentNode.getElementsByTagName('td')[1].getElementsByTagName('input')[0];
        // let price = e.parentNode.parentNode.getElementsByTagName('td')[3].getElementsByTagName('input')[0];
        let unit = e.parentNode.parentNode.getElementsByTagName('td')[2].getElementsByTagName("span")[0];

        raw_items.forEach((item) => {
            if (item.name === value) {
                detail.value = item.detail;
                unit.innerHTML = item.unit;
            }
        })
    }

    function load_items(e) {
        let str = '<option value="null">Select raw item</option>';
        console.log(raw_items);
        if (e.innerHTML.length < 10) {
            raw_items.forEach((item) => {
                str += `<option>` + item.name + `</option>`;
            });
            e.innerHTML = str;
        }



    }

    function populate_cpos() {
        let str = `<ul class="list_cont p-3">`;
        let str2 = ``;
        pos.forEach((po) => {
            str += `<li  class="card m-1 p-1 pointer" onClick="show('${po._id}')" style='font-size:12px'>${po.po_num}</li>`
            str2 += `<option value='${po.po_num}'>${po.po_num}</option>`

        });
        str += '</ul>';
        document.getElementById('po_data_list').innerHTML = str2;

        document.getElementById('cpo_list').innerHTML = str;
    }
    function generate_purchase_order(e) {
        e.disabled = true;
        let ref = encodeURIComponent(document.getElementById('lpo_ref').value);
        let po_num = encodeURIComponent(document.getElementById('pur-po').value);
        let vendor = encodeURIComponent(document.getElementById('pur-company-name').value);
        let date = encodeURIComponent(document.getElementById("pur-date").value);
        let p_date = encodeURIComponent(document.getElementById("payment_date").value);
        let ship_info = {
            name: encodeURIComponent(document.getElementById("pur-ship-name").value),
            address: encodeURIComponent(document.getElementById("pur-ship-address").value),
            city: encodeURIComponent(document.getElementById("pur-ship-city").value),
            phone: encodeURIComponent(document.getElementById("pur-ship-phone").value)
        };
        let items_array = [];
        let currency = encodeURIComponent(document.getElementById('currency').value);
        let table = document.getElementById('items_table');
        let tr = table.getElementsByTagName('tr');
        let item, description, quantity, price, obj;
        for (let i = 0; i < tr.length; i++) {
            item = encodeURIComponent(tr[i].getElementsByTagName('td')[0].getElementsByTagName('select')[0].value);
            description = encodeURIComponent(tr[i].getElementsByTagName('td')[1].getElementsByTagName('input')[0].value);
            quantity = encodeURIComponent(parseFloat(tr[i].getElementsByTagName('td')[2].getElementsByTagName('input')[0].value));
            price = encodeURIComponent(tr[i].getElementsByTagName('td')[3].getElementsByTagName('input')[0].value);
            if (tr[i].getElementsByTagName('td')[0].getElementsByTagName('select')[0].value !== "" &&
                tr[i].getElementsByTagName('td')[2].getElementsByTagName('input')[0].value > 0 &&
                tr[i].getElementsByTagName('td')[3].getElementsByTagName('input')[0].value > 0) {
                obj = {
                    item: item,
                    description: description,
                    quantity: quantity,
                    price: price
                };
                items_array.push(obj);

            }


        };
        if (items_array.length < 1) {
            alert("Please fill atleast one item row");
            return;
        }
        if (ref === "" ||
            po_num === "" ||
            vendor === "" ||
            date === "" ||
            p_date === "") {
            alert("Please fill all fields!");
            return;
        }
        items_array = JSON.stringify(items_array);
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                alert("Purchase Order is Generated");
                e.disabled = false;

                var link = document.createElement("a");
                link.download = 'purchase order.xlsx';
                link.href = '/purchase_order_report';
                link.click();
                document.location.reload();

            }
        };
        xhttp.open("POST", "/purchase_order", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send("ref=" + ref + "&po_num=" + po_num + "&date=" + date + "&p_date=" + p_date + "&currency=" +
            currency + "&purchase_array=" + items_array + "&ship_info=" + JSON.stringify(ship_info) + "&vendor=" +
            vendor);

    }
</script>
<script>
    let old_currency = "PKR";

    function apply_currency(e) {
        old_currency = e.value;
    }

    function currency_effect(e) {
        factor = 1;
        factorold = 1;
        switch (old_currency) {
            case "PKR":
                factorold = 1;
                break;
            case "USD":
                factorold = USD
                break;
            case "EURO":
                factorold = EURO
                break;
            case "GBP":
                factorold = GBP
                break;
            case "AED":
                factorold = AED
                break;

        }

        switch (e.value) {
            case "PKR":
                factor = 1;
                break;
            case "USD":
                factor = USD
                break;
            case "EURO":
                factor = EURO
                break;
            case "GBP":
                factor = GBP
                break;
            case "AED":
                factor = AED
                break;
        }
        let table = document.getElementById('items_table');

        let tr = table.getElementsByTagName('tr');
        for (let i = 0; i < tr.length; i++) {

            tr[i].getElementsByTagName('td')[3].getElementsByTagName('input')[0].value = (tr[i].getElementsByTagName(
                'td')[3].getElementsByTagName('input')[0].value * factorold / factor).toFixed(2);

        };
    }

    function po_search() {
        let po_num = document.getElementById('input_search_po');
        let found = false;
        pos.forEach((po) => {
            if (po.po_num === po_num.value) {
                found = true
                show(po._id);
            }
        })
        if (!found) {
            swal("CPO# Does Not Exist", "", "error")
        } else {
            swal("CPO# Detail is fetched");

        }
    };

    function show(id) {
        pos.forEach((po) => {
            if (po._id === id) {
                console.log("selected", po);
                document.getElementById('pur-date').value = po.date;
                document.getElementById('payment_date').value = po.p_date;
                document.getElementById('pur-po').value = po.po_num.split("/")[2] + "/" + po.po_num.split("/")[3];
                document.getElementById('lpo_ref').value = po.ref;
                document.getElementById('pur-company-name').value = po.vendor;

                fill_vendor();
                // document.getElementById('tax').value = lpo.tax;
                // document.getElementById('discount').value = lpo.discount;
                // document.getElementById('currency').value = lpo.currency;
                let str = '',
                    str3 = '';
                let str2 = '<option value="null">Select Product</option>';
                JSON.parse(po.purchase_array).forEach((item, i) => {
                    str3 = ` <td class="col-6 td-cells">
                            <input type="text" class="form-control" id="pro1description">
                        </td>
                        <td class="col-2 td-cells">
                            <input type="text" class="form-control" id="pro1quantityavailable" style="display: inline;width: 50%;float: left;">
                            <span></span>
                        </td>
                        <td class="col-2 td-cells">
                            <input type="text" class="form-control" id="pro1unitprice" onkeypress="add_new(event)">
                        </td>
                           `;
                    raw_items.forEach((item2) => {
                        // console.log("item p",item,"item o",item2)

                        if (item2.name.toString() === item.item.toString()) {
                            console.log("matched")
                            str2 += `<option selected="selected">` + item2.name + `</option>`;
                            str3 = `<td class="col-6 td-cells">
                                <input type="text" class="form-control" id="pro${i + 1}description" value="${item.description}">
                            </td>
                            <td class="col-2 td-cells">
                                <input type="text" class="form-control" id="pro${i + 1}quantityorder" value="${item.quantity}">
                            </td>
                            <td class="col-2 td-cells">
                                <input type="text" value="${item.price}" class="form-control" id="pro${i + 1}unitprice" onkeypress="sales_add_new(event)">
                            </td>`;

                            // set_item2(item2.name.toString());
                        } else {
                            str2 += `<option>` + item2.name + `</option>`;

                        }
                    })

                    str += ` <tr class="d-flex">
                            <td class="col-2 td-cells">
                                <select class="form-control" id="pro${i + 1}category" onclick="load_items(this)" onchange="set_item(this)">
                                ${str2}
                                    </select>
                            </td>
                            ${str3}
                        </tr>`;
                });
                document.getElementById('items_table').innerHTML = str;

            }
        })
    }
</script>


</html>